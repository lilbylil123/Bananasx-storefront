-<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<link rel="icon" type="image/png" href="favicon.png">

<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BananasX & Co. â€” Storefront</title>
<style>
  :root {
    --bg: #0e1116;
    --card: #12151c;
    --row1: #1e1e1e;
    --row2: #2a2d31;
    --text: #e6e6e6;
    --muted: #a8a8a8;
    --border: #2a2a2a;
    --accent: #ffcc00;
  }

  html, body {
    margin: 0;
    padding: 0;
    background: var(--bg);
    color: var(--text);
    font: 14px/1.5 system-ui, Segoe UI, Roboto, Arial;
    height: 100%;
    width: 100%;
    overflow-x: hidden;        /* âœ… hides any horizontal overflow */
    overflow-y: auto;
  }

  * {
    box-sizing: border-box;
  }

  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--bg);     /* âœ… fills background completely */
    z-index: -1;
  }

  .wrap {
    max-width: 1100px;
    margin: 24px auto;
    padding: 16px;
    overflow-x: hidden;        /* âœ… prevents table overflow */
  }

  .title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
    padding: 12px 16px;
    background: #0b0d12;
    border: 1px solid var(--border);
    border-radius: 12px;
  }

  .title h1 {
    margin: 0;
    font-size: 18px;
    color: var(--accent);
    letter-spacing: 0.4px;
  }

  .table {
    margin-top: 14px;
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow-x: auto;
    background: var(--card);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 100%;
  }

  thead th {
    background: #0e1116;
    color: #ffffff;
    text-align: left;
    font-weight: 600;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 1;
  }

  tbody td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
  }

  tbody tr:nth-child(odd) { background: var(--row1); }
  tbody tr:nth-child(even) { background: var(--row2); }

  .muted {
  color: var(--accent);
  text-shadow: 0 0 8px var(--accent);
  animation: pulse 2s infinite;
  }

  @keyframes pulse {
  0% { text-shadow: 0 0 6px var(--accent); }
  50% { text-shadow: 0 0 14px var(--accent); }
  100% { text-shadow: 0 0 6px var(--accent); }
  }
  
.price { font-weight: 700; }
.right { text-align: right; }
.center { text-align: center; }

  /* Hide SKU column (both header + cells) */
th.muted,
td.muted {
  display: none;
}

/* === Header Hover Sort Effect === */
  thead th {
    cursor: pointer;
    transition: color 0.2s, text-shadow 0.2s;
  }
  thead th:hover {
    color: var(--accent);
    text-shadow: 0 0 8px var(--accent);
  }

  /* === Search Bar Styling === */
  .searchbox {
    margin-top: 16px;
    margin-bottom: 8px;
    text-align: right;
  }

  #search {
    background: var(--card);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 8px 12px;
    border-radius: 8px;
    width: 260px;
    font-size: 14px;
    outline: none;
    transition: border 0.2s, box-shadow 0.2s;
  }

  #search:focus {
    border-color: var(--accent);
    box-shadow: 0 0 8px var(--accent);
  }

  tr.highlight {
    background-color: #3b3b15 !important;
  }

  
</style>

</head>
<body>
  <div class="wrap">
    <div class="title">
      <h1>BananasX &amp; Co. â€” Live Ship Component Stock</h1>
      <span class="muted" id="updated">Fetchingâ€¦</span>
    </div>

    <!-- ðŸ” Search bar -->
    <div class="searchbox">
      <input type="text" id="search" placeholder="ðŸ” Search components..." />
    </div>

    <div class="table">
      <table id="grid">
        <thead>
          <tr>
            <th>Name</th>
            <th class="center">Size</th>
            <th>Type</th>
            <th>Grade</th>
            <th class="center">Current Stock</th>
            <th class="right">Sell Price</th>
            <th class="muted">SKU</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <!-- rows injected by JS -->
        </tbody>
      </table>
    </div>
  </div>


           
<script>
  // === Settings ===
  const CSV_URL = "https://api.allorigins.win/raw?url=" +
  encodeURIComponent("https://docs.google.com/spreadsheets/d/e/2PACX-1vT6xm990HH7LTwD7X8YDM8oeG35kSGPNv0ZKEohbCdm9oDHzC77_v73RVR8KHWRa5udSKHb9oyqEc4o/pub?gid=613857331&single=true&output=csv");


  const GOLD = "#ffcc00";

  // Simple CSV parser (handles commas in values wrapped with quotes)
  function parseCSV(text){
    const rows = [];
    let cur = [], val = "", inQuotes = false;
    for (let i=0;i<text.length;i++){
      const c = text[i], n = text[i+1];
      if (inQuotes){
        if (c === '"' && n === '"'){ val += '"'; i++; continue; }
        if (c === '"' && n !== '"'){ inQuotes = false; continue; }
        val += c;
      } else {
        if (c === '"'){ inQuotes = true; continue; }
        if (c === ','){ cur.push(val); val = ""; continue; }
        if (c === '\n'){ cur.push(val); rows.push(cur); cur = []; val = ""; continue; }
        if (c === '\r'){ continue; }
        val += c;
      }
    }
    if (val.length || cur.length) { cur.push(val); rows.push(cur); }
    return rows;
  }

  function formatPrice(x){
    const n = Number(x);
    if (!isFinite(n)) return x || "";
    // Compact currency-ish (no symbol so it works globally)
    return n >= 1_000_000 ? (n/1_000_000).toFixed(2) + "M"
         : n >= 1_000     ? (n/1_000).toFixed(2) + "K"
         : n.toFixed(0);
  }

  async function load(){
  const t0 = Date.now();
  const res = await fetch(CSV_URL, { cache: "no-store", mode: "cors" });
  const txt = await res.text();
      console.log("CSV text preview:", txt.slice(0, 500));
  const rows = parseCSV(txt).filter(r => r.length);
  if (!rows.length) return;


    // Expect headers in first row from your Public sheet:
    // Name | Size | Type | Grade | Current Stock | Sell Price | SKU
    const head = rows[0].map(s => s.trim());
    const body = rows.slice(1);

    const idx = (name) => head.indexOf(name);
    const iName = idx("Name"),
          iSize = idx("Size"),
          iType = idx("Type"),
          iGrade = idx("Grade"),
          iStock = idx("Current Stock"),
          iPrice = idx("Sell Price"),
          iSku   = idx("SKU");

    const tb = document.getElementById("tbody");

// --- Click-to-sort helper ---
function makeSortable(headers, data, render) {
  const thEls = document.querySelectorAll("thead th");
  let sortKey = null, asc = true;

  thEls.forEach((th, idx) => {
    th.style.cursor = "pointer";
    th.addEventListener("click", () => {
      asc = sortKey === idx ? !asc : true;
      sortKey = idx;

      data.sort((a, b) => {
        const A = (a[idx] || "").toString().toLowerCase();
        const B = (b[idx] || "").toString().toLowerCase();
        const numA = parseFloat(A), numB = parseFloat(B);
        if (!isNaN(numA) && !isNaN(numB)) return asc ? numA - numB : numB - numA;
        return asc ? A.localeCompare(B) : B.localeCompare(A);
      });

      render();
      thEls.forEach(h => h.style.textDecoration = "");
      th.style.textDecoration = asc ? "underline" : "underline overline";
    });
  });
}

// --- Render function ---
function renderTable() {
  tb.innerHTML = "";
  body.forEach(r => {
    if (!r[iName]) return;
    const tr = document.createElement("tr");

    const tdName = document.createElement("td"); tdName.textContent = r[iName] || ""; tr.appendChild(tdName);
    const tdSize = document.createElement("td"); tdSize.textContent = r[iSize] || ""; tdSize.className="center"; tr.appendChild(tdSize);
    const tdType = document.createElement("td"); tdType.textContent = r[iType] || ""; tr.appendChild(tdType);
    const tdGrade= document.createElement("td"); tdGrade.textContent= r[iGrade]|| ""; tr.appendChild(tdGrade);

    const stockVal = Number(r[iStock] || 0);
    const tdStock= document.createElement("td"); tdStock.textContent = isFinite(stockVal)? stockVal : (r[iStock]||""); tdStock.className="center"; tr.appendChild(tdStock);

    const tdPrice= document.createElement("td"); tdPrice.textContent = formatPrice(r[iPrice]); tdPrice.className="right price";
    if (stockVal > 0) tdPrice.style.color = GOLD;
    tr.appendChild(tdPrice);

    const tdSku  = document.createElement("td"); tdSku.textContent   = r[iSku] || ""; tdSku.className="muted"; tr.appendChild(tdSku);

    tb.appendChild(tr);
  });
}

// --- Initial render + make headers sortable ---
renderTable();
makeSortable(head, body, renderTable);


    // Updated time
    const ms = Date.now() - t0;
    const d = new Date();
    document.getElementById("updated").textContent = "Updated " +
      d.toLocaleString([], {hour:'2-digit', minute:'2-digit'}) + " â€¢ " + ms + "ms";
  }

  load();
  // Optional: refresh every 2 minutes
  // setInterval(load, 120000);
</script>
</body>
</html>
